(()=>{var e={116:function(e,o){"use strict";var t=this&&this.__assign||function(){return t=Object.assign||function(e){for(var o,t=1,n=arguments.length;t<n;t++)for(var r in o=arguments[t])Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);return e},t.apply(this,arguments)};function n(e,o){if(!o)return"";var t="; "+e;return!0===o?t:t+"="+o}function r(e,o,t){return encodeURIComponent(e).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(o).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(e){if("number"==typeof e.expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*e.expires),e.expires=o}return n("Expires",e.expires?e.expires.toUTCString():"")+n("Domain",e.domain)+n("Path",e.path)+n("Secure",e.secure)+n("SameSite",e.sameSite)}(t)}function a(e){for(var o={},t=e?e.split("; "):[],n=/(%[\dA-F]{2})+/gi,r=0;r<t.length;r++){var a=t[r].split("="),c=a.slice(1).join("=");'"'===c.charAt(0)&&(c=c.slice(1,-1));try{o[a[0].replace(n,decodeURIComponent)]=c.replace(n,decodeURIComponent)}catch(e){}}return o}function c(){return a(document.cookie)}function i(e,o,n){document.cookie=r(e,o,t({path:"/"},n))}o.__esModule=!0,o.encode=r,o.parse=a,o.getAll=c,o.get=function(e){return c()[e]},o.set=i,o.remove=function(e,o){i(e,"",t(t({},o),{expires:-1}))}}},o={};function t(n){var r=o[n];if(void 0!==r)return r.exports;var a=o[n]={exports:{}};return e[n].call(a.exports,a,a.exports,t),a.exports}t.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},t.d=(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},t.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";t.r(n);const e=flarum.core.compat["forum/app"];var o=t.n(e);const r=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/components/SettingsPage"];var c=t.n(a);const i=flarum.core.compat["forum/components/SessionDropdown"];var s=t.n(i);const u=flarum.core.compat["forum/components/HeaderSecondary"];var f=t.n(u);const d=flarum.core.compat["common/components/Button"];var p=t.n(d);const l=flarum.core.compat["common/components/LoadingIndicator"];var h=t.n(l);const g=flarum.core.compat["common/components/Select"];var v=t.n(g);const y=flarum.core.compat["common/components/FieldSet"];var _=t.n(y);const S=flarum.core.compat["common/components/Switch"];var T=t.n(S);flarum.core.compat["common/helpers/icon"];const b=flarum.core.compat["common/app"];var N=t.n(b);const A=flarum.core.compat["common/components/Page"];var U=t.n(A),x="fof-nightmode.default_theme";const D={AUTO:0,LIGHT:1,DARK:2,DEFAULT:function(){var e;return Number.parseInt((null==(e=N().data.settings)?void 0:e[x])||N().data[x])||0}};var M=t(116),O="flarum_nightmode",I=function(){var e=M.get(O);return e||"0"===e?Number(e):D.DEFAULT()},w=function(e){return M.set(O,e,{sameSite:"lax",secure:"https:"===location.protocol})};function k(){var e=Array.from(new Set(Object.values(D))),o=I();isNaN(o)?R("Theme is not a valid integer! Resetting..."):e.includes(o)||R("Theme is out of bounds! Resetting...")}function R(e){console.warn(e),w(D.DEFAULT())}function L(){var e,o=app.session.user,t=!o||!!o.preferences().fofNightMode_perDevice,n=o&&o.preferences().fofNightMode;return t?e=I():"number"==typeof n&&-1!==n&&(e=n),"number"==typeof e?e:D.DEFAULT()}function P(){var e,o,t=N().session.user,n=null==(e=N().session.user)?void 0:e.preferences().fofNightMode_perDevice;t&&!n||k(),n&&k(),j((o=L())===D.DARK?"night":o===D.LIGHT?"day":window.matchMedia("(prefers-color-scheme: dark)").matches?"night":"day")}function C(){return{day:N().data["fof-nightmode.assets.day"],night:N().data["fof-nightmode.assets.night"]}}function j(e){var o=document.querySelector("link.nightmode-light[rel=stylesheet]"),t=document.querySelector("link.nightmode-dark[rel=stylesheet]");if(o&&t){if(L()===D.AUTO)return;var n=document.createElement("link");"onload"in n?n.onload=function(){o.remove(),t.remove()}:(o.remove(),t.remove()),n.rel="stylesheet",n.className="nightmode",n.href=C()[e],document.head.append(n)}else{var r=o||t||document.querySelector("link.nightmode[rel=stylesheet]"),a=C()[e];a!==r.href&&(r.href=a,r.className="nightmode")}}var E=function(e){return o().translator.trans("fof-nightmode.forum.user.settings."+e)},F=function(e){return e===D.LIGHT||e===D.AUTO&&!window.matchMedia("(prefers-color-scheme: dark)").matches};o().initializers.add("fof-nightmode",(function(){(0,r.extend)(c().prototype,"settingsItems",(function(e){var t=o().session.user,n=!!t.preferences().fofNightMode_perDevice;n&&k();var r=!window.matchMedia("not all and (prefers-color-scheme), (prefers-color-scheme)").matches,a=L(),c={0:E("options.auto"),1:E("options.day"),2:E("options.night")};r&&(delete c[0],a===D.AUTO&&(a=o().forum.attribute("fofNightMode_autoUnsupportedFallback"))),e.add("fof-nightmode",_().component({label:E("heading"),className:"Settings-theme"},[m("p",{className:"description"},E("description")),m("p",{className:"description"},E("description2")),r?m("p",{class:"description NightMode-autoUnsupported"},E("auto_unsupported")):null,T().component({className:"Settings-theme--per_device_cb",state:n,onchange:function(e){e?w(a):M.remove(O),t.savePreferences({fofNightMode_perDevice:e}).then((function(){P()}))}},E("device_specific_setting_checkbox")),v().component({value:a,className:"Settings-theme--input",onchange:function(e){if(n)return w(e),void P();t.savePreferences({fofNightMode:e}).then((function(){m.redraw(),P()}))},options:c}),m("p",{className:"Settings-theme--selection_description"},a===D.AUTO?E("option_descriptions.auto"):a===D.LIGHT?E("option_descriptions.day"):a===D.DARK?E("option_descriptions.night"):h().component())]))})),(0,r.extend)(f().prototype,"items",(function(e){if(!o().session.user){var t=L(),n=F(t);e.add("nightmode",m(p(),{className:"Button Button--flat",onclick:function(){var e,o=(e=t)===D.AUTO?D.LIGHT:e===D.LIGHT?D.DARK:D.AUTO;w(o),P()},icon:t===D.AUTO?"fas fa-adjust":"far fa-"+(n?"sun":"moon")},o().translator.trans("fof-nightmode.forum.header.nightmode_button")),15)}})),(0,r.extend)(s().prototype,"items",(function(e){if(o().session.user){var t=o().session.user,n=F(L());e.add(n?"nightmode":"daymode",p().component({icon:"far fa-"+(n?"moon":"sun"),onclick:function(){var e=n?D.DARK:D.LIGHT;if(t.preferences().fofNightMode_perDevice)return w(e),void P();t.savePreferences({fofNightMode:e}).then((function(){P()}))}},o().translator.trans("fof-nightmode.forum."+(n?"night":"day"))),-1)}})),(0,r.extend)(U().prototype,"oninit",P)}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map