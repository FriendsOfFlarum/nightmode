(()=>{var e={n:o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return e.d(t,{a:t}),t},d:(o,t)=>{for(var n in t)e.o(t,n)&&!e.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:t[n]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};(()=>{"use strict";e.r(o),e.d(o,{Themes:()=>a,getTheme:()=>b,perDeviceSetting:()=>t,setSelectedTheme:()=>n,switchTheme:()=>r});var t={};e.r(t),e.d(t,{KEY:()=>h,get:()=>g,remove:()=>y,set:()=>v});var n={};e.r(n),e.d(n,{default:()=>N,getUrls:()=>U,setStyle:()=>A,setTheme:()=>_,setThemeFromID:()=>w});var r={};e.r(r),e.d(r,{getIsLight:()=>z,switchTheme:()=>Y});const i=flarum.core.compat["common/app"];var c=e.n(i);const a={AUTO:0,LIGHT:1,DARK:2,DEFAULT:function(){return c().forum.attribute("fof-nightmode.default_theme")||0}},s=flarum.core.compat["common/extend"],d=flarum.core.compat["common/components/Page"];var f=e.n(d),u=function(){return u=Object.assign||function(e){for(var o,t=1,n=arguments.length;t<n;t++)for(var r in o=arguments[t])Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);return e},u.apply(this,arguments)};function p(e,o){if(!o)return"";var t="; "+e;return!0===o?t:t+"="+o}function l(e,o,t){document.cookie=function(e,o,t){return encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(o).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)+function(e){if("number"==typeof e.expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*e.expires),e.expires=o}return p("Expires",e.expires?e.expires.toUTCString():"")+p("Domain",e.domain)+p("Path",e.path)+p("Secure",e.secure)+p("SameSite",e.sameSite)}(t)}(e,o,u({path:"/"},t))}var h="flarum_nightmode",g=function(){var e,o=(e=h,function(e){for(var o={},t=0,n=e?e.split("; "):[];t<n.length;t++){var r=n[t].split("="),i=r.slice(1).join("=");'"'===i[0]&&(i=i.slice(1,-1));try{o[decodeURIComponent(r[0])]=i.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)}catch(e){}}return o}(document.cookie)[e]);return o||"0"===o?Number(o):a.DEFAULT()},v=function(e){return l(h,e,{sameSite:"lax",secure:"https:"===location.protocol})},y=function(){l(h,"",u(u({},undefined),{expires:-1}))};function T(){var e=Array.from(new Set(Object.values(a))),o=g();isNaN(o)?S("Theme is not a valid integer! Resetting..."):e.includes(o)||S("Theme is out of bounds! Resetting...")}function S(e){console.warn(e),v(a.DEFAULT())}function b(){var e,o=c().session.user,t=!o||!!o.preferences().fofNightMode_perDevice,n=o&&o.preferences().fofNightMode;return t?e=g():"number"==typeof n&&-1!==n&&(e=n),"number"==typeof e?e:a.DEFAULT()}const N=function(){(0,s.extend)(f().prototype,"oninit",_),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",_)};function _(){var e,o=c().session.user,t=null==(e=c().session.user)?void 0:e.preferences().fofNightMode_perDevice;o&&!t||T(),t&&T(),w(b())}function U(){return{day:c().data["fof-nightmode.assets.day"],night:c().data["fof-nightmode.assets.night"]}}function w(e){e===a.DARK?A("night"):e===a.LIGHT?A("day"):A(window.matchMedia("(prefers-color-scheme: dark)").matches?"night":"day")}function A(e){var o=document.querySelector("link.nightmode-light[rel=stylesheet]"),t=document.querySelector("link.nightmode-dark[rel=stylesheet]");e:if(o&&t){if(b()===a.AUTO)break e;var n=document.createElement("link");"onload"in n?n.onload=function(){o.remove(),t.remove()}:(o.remove(),t.remove()),n.rel="stylesheet",n.className="nightmode",n.href=U()[e],document.head.append(n)}else{var r=o||t||document.querySelector("link.nightmode[rel=stylesheet]"),i=U()[e];i!==r.href&&(r.href=i,r.className="nightmode")}var c=document.querySelector('meta[name="color-scheme"]');c&&(c.content="night"===e?"dark":"light");var s=new CustomEvent("fofnightmodechange",{detail:e});document.dispatchEvent(s)}const D=flarum.core.compat["forum/app"];var M=e.n(D);const O=flarum.core.compat["forum/components/SettingsPage"];var I=e.n(O);const k=flarum.core.compat["forum/components/SessionDropdown"];var x=e.n(k);const L=flarum.core.compat["forum/components/HeaderSecondary"];var R=e.n(L);const E=flarum.core.compat["common/components/Button"];var C=e.n(E);const P=flarum.core.compat["common/components/LoadingIndicator"];var F=e.n(P);const j=flarum.core.compat["common/components/Select"];var H=e.n(j);const B=flarum.core.compat["common/components/FieldSet"];var G=e.n(B);const K=flarum.core.compat["common/components/Switch"];var q=e.n(K);function z(e){return e===a.LIGHT||e===a.AUTO&&!window.matchMedia("(prefers-color-scheme: dark)").matches}function Y(){var e,o=b(),t=z(o),n=M().session.user;if(n){var r=t?a.DARK:a.LIGHT;if(n.preferences().fofNightMode_perDevice)return v(r),void _();n.savePreferences({fofNightMode:r}).then((function(){_()}))}else{var i=(e=o)===a.AUTO?a.LIGHT:e===a.LIGHT?a.DARK:a.AUTO;v(i),_()}}var J=function(e){return M().translator.trans("fof-nightmode.forum.user.settings."+e)};M().initializers.add("fof-nightmode",(function(){(0,s.extend)(I().prototype,"settingsItems",(function(e){var o=M().session.user,t=!!o.preferences().fofNightMode_perDevice;t&&T();var n=!window.matchMedia("not all and (prefers-color-scheme), (prefers-color-scheme)").matches,r=b(),i={0:J("options.auto"),1:J("options.day"),2:J("options.night")};n&&(delete i[0],r===a.AUTO&&(r=M().forum.attribute("fofNightMode_autoUnsupportedFallback"))),e.add("fof-nightmode",G().component({label:J("heading"),className:"Settings-theme"},[m("p",{className:"description"},J("description")),m("p",{className:"description"},J("description2")),n?m("p",{class:"description NightMode-autoUnsupported"},J("auto_unsupported")):null,q().component({className:"Settings-theme--per_device_cb",state:t,onchange:function(e){e?v(r):y(),o.savePreferences({fofNightMode_perDevice:e}).then((function(){_()}))}},J("device_specific_setting_checkbox")),H().component({value:r,className:"Settings-theme--input",onchange:function(e){if(t)return v(e),void _();o.savePreferences({fofNightMode:e}).then((function(){m.redraw(),_()}))},options:i}),m("p",{className:"Settings-theme--selection_description"},r===a.AUTO?J("option_descriptions.auto"):r===a.LIGHT?J("option_descriptions.day"):r===a.DARK?J("option_descriptions.night"):F().component())]))})),(0,s.extend)(R().prototype,"items",(function(e){if(!M().session.user||M().forum.attribute("fofNightMode.showThemeToggleOnHeaderAlways")){var o=b(),t=z(o);e.add("nightmode",m(C(),{className:"Button Button--flat",onclick:function(){Y()},icon:o===a.AUTO?"fas fa-adjust":"far fa-"+(t?"sun":"moon")},M().translator.trans("fof-nightmode.forum.header.nightmode_button")),15)}})),(0,s.extend)(x().prototype,"items",(function(e){if(M().session.user){var o=z(b());e.add(o?"nightmode":"daymode",C().component({icon:"far fa-"+(o?"moon":"sun"),onclick:function(){Y()}},M().translator.trans("fof-nightmode.forum."+(o?"night":"day"))),-1)}})),N()}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map