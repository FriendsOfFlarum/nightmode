(()=>{var e={n:o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return e.d(t,{a:t}),t},d:(o,t)=>{for(var n in t)e.o(t,n)&&!e.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:t[n]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};(()=>{"use strict";e.r(o),e.d(o,{Themes:()=>c,getTheme:()=>S,perDeviceSetting:()=>t,setSelectedTheme:()=>n,switchTheme:()=>r});var t={};e.r(t),e.d(t,{KEY:()=>h,get:()=>g,remove:()=>y,set:()=>v});var n={};e.r(n),e.d(n,{default:()=>b,getUrls:()=>w,setStyle:()=>U,setTheme:()=>N,setThemeFromID:()=>M});var r={};e.r(r),e.d(r,{getIsLight:()=>z,switchTheme:()=>Y});const i=flarum.core.compat["common/app"];var a=e.n(i);const c={AUTO:0,LIGHT:1,DARK:2,DEFAULT:function(){return a().forum.attribute("fof-nightmode.default_theme")||0}},s=flarum.core.compat["common/extend"],f=flarum.core.compat["common/components/Page"];var d=e.n(f),u=function(){return u=Object.assign||function(e){for(var o,t=1,n=arguments.length;t<n;t++)for(var r in o=arguments[t])Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);return e},u.apply(this,arguments)};function p(e,o){if(!o)return"";var t="; "+e;return!0===o?t:t+"="+o}function l(e,o,t){document.cookie=function(e,o,t){return encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(o).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)+function(e){if("number"==typeof e.expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*e.expires),e.expires=o}return p("Expires",e.expires?e.expires.toUTCString():"")+p("Domain",e.domain)+p("Path",e.path)+p("Secure",e.secure)+p("SameSite",e.sameSite)}(t)}(e,o,u({path:"/"},t))}var h="flarum_nightmode",g=function(){var e,o=(e=h,function(e){for(var o={},t=0,n=e?e.split("; "):[];t<n.length;t++){var r=n[t].split("="),i=r.slice(1).join("=");'"'===i[0]&&(i=i.slice(1,-1));try{o[decodeURIComponent(r[0])]=i.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)}catch(e){}}return o}(document.cookie)[e]);return o||"0"===o?Number(o):c.DEFAULT()},v=function(e){return l(h,e,{sameSite:"lax",secure:"https:"===location.protocol})},y=function(){l(h,"",u(u({},undefined),{expires:-1}))};function T(){var e=Array.from(new Set(Object.values(c))),o=g();isNaN(o)?_("Theme is not a valid integer! Resetting..."):e.includes(o)||_("Theme is out of bounds! Resetting...")}function _(e){console.warn(e),v(c.DEFAULT())}function S(){var e,o=a().session.user,t=!o||!!o.preferences().fofNightMode_perDevice,n=o&&o.preferences().fofNightMode;return t?e=g():"number"==typeof n&&-1!==n&&(e=n),"number"==typeof e?e:c.DEFAULT()}const b=function(){(0,s.extend)(d().prototype,"oninit",N),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",N)};function N(){var e,o=a().session.user,t=null==(e=a().session.user)?void 0:e.preferences().fofNightMode_perDevice;o&&!t||T(),t&&T(),M(S())}function w(){return{day:a().data["fof-nightmode.assets.day"],night:a().data["fof-nightmode.assets.night"]}}function M(e){e===c.DARK?U("night"):e===c.LIGHT?U("day"):U(window.matchMedia("(prefers-color-scheme: dark)").matches?"night":"day")}function U(e){var o=document.querySelector("link.nightmode-light[rel=stylesheet]"),t=document.querySelector("link.nightmode-dark[rel=stylesheet]");e:if(o&&t){if(S()===c.AUTO)break e;var n=document.createElement("link");"onload"in n?n.onload=function(){o.remove(),t.remove()}:(o.remove(),t.remove()),n.rel="stylesheet",n.className="nightmode",n.href=w()[e],document.head.append(n)}else{var r=o||t||document.querySelector("link.nightmode[rel=stylesheet]"),i=w()[e];i!==r.href&&(r.href=i,r.className="nightmode")}var a=document.querySelector('meta[name="color-scheme"]');a&&(a.content="night"===e?"dark":"light");var s=new CustomEvent("fofnightmodechange",{detail:e});document.dispatchEvent(s)}const A=flarum.core.compat["forum/app"];var D=e.n(A);const O=flarum.core.compat["forum/components/SettingsPage"];var I=e.n(O);const k=flarum.core.compat["forum/components/SessionDropdown"];var x=e.n(k);const L=flarum.core.compat["forum/components/HeaderSecondary"];var R=e.n(L);const E=flarum.core.compat["common/components/Button"];var C=e.n(E);const P=flarum.core.compat["common/components/LoadingIndicator"];var F=e.n(P);const j=flarum.core.compat["common/components/Select"];var H=e.n(j);const B=flarum.core.compat["common/components/FieldSet"];var G=e.n(B);const K=flarum.core.compat["common/components/Switch"];var q=e.n(K);function z(e){return e===c.LIGHT||e===c.AUTO&&!window.matchMedia("(prefers-color-scheme: dark)").matches}function Y(){var e,o=S(),t=z(o),n=D().session.user;if(n){var r=t?c.DARK:c.LIGHT;if(n.preferences().fofNightMode_perDevice)return v(r),void N();n.savePreferences({fofNightMode:r}).then((function(){N()}))}else{var i=(e=o)===c.AUTO?c.LIGHT:e===c.LIGHT?c.DARK:c.AUTO;v(i),N()}}var J=function(e){return D().translator.trans("fof-nightmode.forum.user.settings."+e)};D().initializers.add("fof-nightmode",(function(){(0,s.extend)(I().prototype,"settingsItems",(function(e){var o=D().session.user,t=!!o.preferences().fofNightMode_perDevice;t&&T();var n=!window.matchMedia("not all and (prefers-color-scheme), (prefers-color-scheme)").matches,r=S(),i={0:J("options.auto"),1:J("options.day"),2:J("options.night")};n&&(delete i[0],r===c.AUTO&&(r=D().forum.attribute("fofNightMode_autoUnsupportedFallback"))),e.add("fof-nightmode",G().component({label:J("heading"),className:"Settings-theme"},[m("p",{className:"description"},J("description")),m("p",{className:"description"},J("description2")),n?m("p",{class:"description NightMode-autoUnsupported"},J("auto_unsupported")):null,q().component({className:"Settings-theme--per_device_cb",state:t,onchange:function(e){e?v(r):y(),o.savePreferences({fofNightMode_perDevice:e}).then((function(){N()}))}},J("device_specific_setting_checkbox")),H().component({value:r,className:"Settings-theme--input",onchange:function(e){if(t)return v(e),void N();o.savePreferences({fofNightMode:e}).then((function(){m.redraw(),N()}))},options:i}),m("p",{className:"Settings-theme--selection_description"},r===c.AUTO?J("option_descriptions.auto"):r===c.LIGHT?J("option_descriptions.day"):r===c.DARK?J("option_descriptions.night"):F().component())]))})),(0,s.extend)(R().prototype,"items",(function(e){if(!D().session.user||D().forum.attribute("fofNightMode.showThemeToggleOnHeaderAlways")){var o=S(),t=z(o),n=D().forum.attribute("fofNightMode.show_theme_toggle_in_solid")?"fas fa-":"far fa-";e.add("nightmode",m(C(),{className:"Button Button--flat",onclick:function(){Y()},icon:o===c.AUTO?"fas fa-adjust":t?n+"sun":n+"moon"},D().translator.trans("fof-nightmode.forum.header.nightmode_button")),15)}})),(0,s.extend)(x().prototype,"items",(function(e){if(D().session.user){var o=z(S()),t=D().forum.attribute("fofNightMode.show_theme_toggle_in_solid")?"fas fa-":"far fa-";e.add(o?"nightmode":"daymode",C().component({icon:o?t+"moon":t+"sun",onclick:function(){Y()}},D().translator.trans("fof-nightmode.forum."+(o?"night":"day"))),-1)}})),b()}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map