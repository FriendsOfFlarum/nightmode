(()=>{var e={116:function(e,t){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)};function n(e,t){if(!t)return"";var o="; "+e;return!0===t?o:o+"="+t}function r(e,t,o){return encodeURIComponent(e).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(t).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(e){if("number"==typeof e.expires){var t=new Date;t.setMilliseconds(t.getMilliseconds()+864e5*e.expires),e.expires=t}return n("Expires",e.expires?e.expires.toUTCString():"")+n("Domain",e.domain)+n("Path",e.path)+n("Secure",e.secure)+n("SameSite",e.sameSite)}(o)}function i(e){for(var t={},o=e?e.split("; "):[],n=/(%[\dA-F]{2})+/gi,r=0;r<o.length;r++){var i=o[r].split("="),s=i.slice(1).join("=");'"'===s.charAt(0)&&(s=s.slice(1,-1));try{t[i[0].replace(n,decodeURIComponent)]=s.replace(n,decodeURIComponent)}catch(e){}}return t}function s(){return i(document.cookie)}function c(e,t,n){document.cookie=r(e,t,o({path:"/"},n))}t.__esModule=!0,t.encode=r,t.parse=i,t.getAll=s,t.get=function(e){return s()[e]},t.set=c,t.remove=function(e,t){c(e,"",o(o({},t),{expires:-1}))}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,o),i.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";o.r(n),o.d(n,{Themes:()=>c,getTheme:()=>T,perDeviceSetting:()=>e,setSelectedTheme:()=>t,switchTheme:()=>r});var e={};o.r(e),o.d(e,{KEY:()=>p,get:()=>l,remove:()=>g,set:()=>h});var t={};o.r(t),o.d(t,{default:()=>S,getUrls:()=>b,setStyle:()=>N,setTheme:()=>_,setThemeFromID:()=>A});var r={};o.r(r),o.d(r,{getIsLight:()=>K,switchTheme:()=>q});const i=flarum.core.compat["common/app"];var s=o.n(i);const c={AUTO:0,LIGHT:1,DARK:2,DEFAULT:function(){return s().forum.attribute("fof-nightmode.default_theme")||0}},a=flarum.core.compat["common/extend"],u=flarum.core.compat["common/components/Page"];var f=o.n(u),d=o(116),p="flarum_nightmode",l=function(){var e=d.get(p);return e||"0"===e?Number(e):c.DEFAULT()},h=function(e){return d.set(p,e,{sameSite:"lax",secure:"https:"===location.protocol})},g=function(){return d.remove(p)};function v(){var e=Array.from(new Set(Object.values(c))),t=l();isNaN(t)?y("Theme is not a valid integer! Resetting..."):e.includes(t)||y("Theme is out of bounds! Resetting...")}function y(e){console.warn(e),h(c.DEFAULT())}function T(){var e,t=s().session.user,o=!t||!!t.preferences().fofNightMode_perDevice,n=t&&t.preferences().fofNightMode;return o?e=l():"number"==typeof n&&-1!==n&&(e=n),"number"==typeof e?e:c.DEFAULT()}const S=function(){(0,a.extend)(f().prototype,"oninit",_)};function _(){var e,t=s().session.user,o=null==(e=s().session.user)?void 0:e.preferences().fofNightMode_perDevice;t&&!o||v(),o&&v(),A(T())}function b(){return{day:s().data["fof-nightmode.assets.day"],night:s().data["fof-nightmode.assets.night"]}}function A(e){e===c.DARK?N("night"):e===c.LIGHT?N("day"):N(window.matchMedia("(prefers-color-scheme: dark)").matches?"night":"day")}function N(e){var t=document.querySelector("link.nightmode-light[rel=stylesheet]"),o=document.querySelector("link.nightmode-dark[rel=stylesheet]");if(t&&o){if(T()===c.AUTO)return;var n=document.createElement("link");"onload"in n?n.onload=function(){t.remove(),o.remove()}:(t.remove(),o.remove()),n.rel="stylesheet",n.className="nightmode",n.href=b()[e],document.head.append(n)}else{var r=t||o||document.querySelector("link.nightmode[rel=stylesheet]"),i=b()[e];i!==r.href&&(r.href=i,r.className="nightmode")}}const D=flarum.core.compat["forum/app"];var U=o.n(D);const x=flarum.core.compat["forum/components/SettingsPage"];var M=o.n(x);const w=flarum.core.compat["forum/components/SessionDropdown"];var O=o.n(w);const I=flarum.core.compat["forum/components/HeaderSecondary"];var k=o.n(I);const L=flarum.core.compat["common/components/Button"];var R=o.n(L);const P=flarum.core.compat["common/components/LoadingIndicator"];var C=o.n(P);const E=flarum.core.compat["common/components/Select"];var F=o.n(E);const j=flarum.core.compat["common/components/FieldSet"];var H=o.n(j);const B=flarum.core.compat["common/components/Switch"];var G=o.n(B);function K(e){return e===c.LIGHT||e===c.AUTO&&!window.matchMedia("(prefers-color-scheme: dark)").matches}function q(){var e,t=T(),o=K(t),n=U().session.user;if(n){var r=o?c.DARK:c.LIGHT;if(n.preferences().fofNightMode_perDevice)return h(r),void _();n.savePreferences({fofNightMode:r}).then((function(){_()}))}else{var i=(e=t)===c.AUTO?c.LIGHT:e===c.LIGHT?c.DARK:c.AUTO;h(i),_()}}var z=function(e){return U().translator.trans("fof-nightmode.forum.user.settings."+e)};U().initializers.add("fof-nightmode",(function(){(0,a.extend)(M().prototype,"settingsItems",(function(e){var t=U().session.user,o=!!t.preferences().fofNightMode_perDevice;o&&v();var n=!window.matchMedia("not all and (prefers-color-scheme), (prefers-color-scheme)").matches,r=T(),i={0:z("options.auto"),1:z("options.day"),2:z("options.night")};n&&(delete i[0],r===c.AUTO&&(r=U().forum.attribute("fofNightMode_autoUnsupportedFallback"))),e.add("fof-nightmode",H().component({label:z("heading"),className:"Settings-theme"},[m("p",{className:"description"},z("description")),m("p",{className:"description"},z("description2")),n?m("p",{class:"description NightMode-autoUnsupported"},z("auto_unsupported")):null,G().component({className:"Settings-theme--per_device_cb",state:o,onchange:function(e){e?h(r):g(),t.savePreferences({fofNightMode_perDevice:e}).then((function(){_()}))}},z("device_specific_setting_checkbox")),F().component({value:r,className:"Settings-theme--input",onchange:function(e){if(o)return h(e),void _();t.savePreferences({fofNightMode:e}).then((function(){m.redraw(),_()}))},options:i}),m("p",{className:"Settings-theme--selection_description"},r===c.AUTO?z("option_descriptions.auto"):r===c.LIGHT?z("option_descriptions.day"):r===c.DARK?z("option_descriptions.night"):C().component())]))})),(0,a.extend)(k().prototype,"items",(function(e){if(!U().session.user||U().forum.attribute("fofNightMode.showThemeToggleOnHeaderAlways")){var t=T(),o=K(t);e.add("nightmode",m(R(),{className:"Button Button--flat",onclick:function(){q()},icon:t===c.AUTO?"fas fa-adjust":"far fa-"+(o?"sun":"moon")},U().translator.trans("fof-nightmode.forum.header.nightmode_button")),15)}})),(0,a.extend)(O().prototype,"items",(function(e){if(U().session.user){var t=K(T());e.add(t?"nightmode":"daymode",R().component({icon:"far fa-"+(t?"moon":"sun"),onclick:function(){q()}},U().translator.trans("fof-nightmode.forum."+(t?"night":"day"))),-1)}})),S()}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map